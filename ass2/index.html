<!DOCTYPE html>
<html>
<head>
    <title>Grocery</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/mystyle.css">

</head>
<body>

<p id="details"></p>
<button id="btn" onclick="btnClick()">Button</button>
<div><b>Product List</b></div>
<div id="demo"></div>

<script>

    var CategoriesRoot = []; 
    var ProductsRoot = [];
    readProducts();
    var xhttp = new XMLHttpRequest();
  xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
      readCategories(this);

      myFunction(this);
    }
  };
  

  xhttp.open("GET", "xml/categories.xml", true);
  xhttp.send();

  function readProducts() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                // Read data from xml and store to js vector
                readProductsdata(this);
 
            }
        };

        xhttp.open("GET", "xml/products.xml", true);
        xhttp.send();
    }

    function readProductsdata(xml) {
        var xmlDoc = xml.responseXML;
        var x = xmlDoc.getElementsByTagName("Products");

        for (let index = 0; index < x.length; index++) {
            //Store all categories' elements
            var ProductID = x[index].getElementsByTagName("ProductID")[0].childNodes[0].nodeValue;
            var ProductName = x[index].getElementsByTagName("ProductName")[0].childNodes[0].nodeValue;
            var CategoryID = x[index].getElementsByTagName("CategoryID")[0].childNodes[0].nodeValue;
            var QuantityPerUnit = x[index].getElementsByTagName("QuantityPerUnit")[0].childNodes[0].nodeValue;
            var UnitPrice = x[index].getElementsByTagName("UnitPrice")[0].childNodes[0].nodeValue;

            var Products = new Object();
            Products.ProductID = ProductID;
            Products.ProductName = ProductName;
            Products.CategoryID = CategoryID;
            Products.QuantityPerUnit = QuantityPerUnit;
            Products.UnitPrice = UnitPrice;

            ProductsRoot.push(Products);
        }

    }

function myFunction(xml) {

  var data = [];
  var xmlDoc = xml.responseXML;
  var ol="<ol class='q'>";

  var x = xmlDoc.getElementsByTagName("Categories");

  // To store categores
  for (let index = 0; index < x.length; index++) {
    //description
    var str = x[index].getElementsByTagName("Description")[0].childNodes[0].nodeValue;
    var arr = str.split(",");

    var cates = new Object();
    cates.CategoryName = x[index].getElementsByTagName("CategoryName")[0].childNodes[0].nodeValue;
    cates.Description = arr;

    data.push(cates);

  }

  //Show on the page
  for (let i = 0; i <CategoriesRoot.length; i++) { 
    //ol+="<li  onclick='btnClick(this)'><a href='#'>"+
      ol+='<li name="'+CategoriesRoot[i].CategoryName+'" onclick="btnClick(this)"><a href="#">'+
      CategoriesRoot[i].CategoryName +
        "</a><ol class='n'>";

        for (let j = 0; j < ProductsRoot.length; j++) {
          var currentIID = CategoriesRoot[i].CategoryID;
          var currentJID = ProductsRoot[j].CategoryID;
          if(currentIID == currentJID){
            ol+="<li>"+
              ProductsRoot[j].ProductName +
          "</li>";
            
         
          }

          
        }

        ol += "</ol>" +

      "</li>";
  }

  ol+="</ol>"
  document.getElementById("demo").innerHTML = ol;
}



function readCategories(xml) {

  var xmlDoc = xml.responseXML;
  var x = xmlDoc.getElementsByTagName("Categories");

  // To store categores
  for (let index = 0; index < x.length; index++) {

    //Store all categories' elements
      var CategoryID = x[index].getElementsByTagName("CategoryID")[0].childNodes[0].nodeValue;
      var CategoryName = x[index].getElementsByTagName("CategoryName")[0].childNodes[0].nodeValue;
      var Description = x[index].getElementsByTagName("Description")[0].childNodes[0].nodeValue;
      var Categories = new Object();
      Categories.CategoryID = CategoryID;
      Categories.CategoryName = CategoryName;
      Categories.Description = Description;

      CategoriesRoot.push(Categories);
  }

}

function btnClick(x) {
  
  document.getElementById("details").innerHTML = x.innerText;
}

function assignNames(){
  deocument.getElementsByTagName();
}
</script>

</body>
</html>
