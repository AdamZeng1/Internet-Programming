<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
    <link rel="stylesheet" href="jqtree.css">
    <script src="jquery.min.js"></script>
    <script src="tree.jquery.js"></script>

</head>
<body>
    <p id="demo"></p>
    <div id="tree1"></div>

<script>

    var CategoriesRoot = []; 
    var ProductsRoot = [];
    readProducts();
// Read xml file
var xhttp = new XMLHttpRequest();
xhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
    // Read data from xml and store to js vector
        readCategories(this); 
        var data = generateData();

        $(function () {
            $('#tree1').tree({
                data: data,
                closedIcon: $('<i class="fas fa-arrow-circle-right"></i>'),
                openedIcon: $('<i class="fas fa-arrow-circle-down"></i>')

            });
        });


}
};

xhttp.open("GET", "../xml/categories.xml", true);
xhttp.send();

function generateData() {
    var data = [];
    for (let i = 0; i < CategoriesRoot.length; i++) {
        var obj = new Object();
        var children = [];     
        //childen
        for (let j = 0; j < ProductsRoot.length; j++) {
            var child = new Object();
            var currentIID = CategoriesRoot[i].CategoryID;
            var currentJID = ProductsRoot[j].CategoryID;
            //child.name = ProductsRoot[j].
            if(currentIID == currentJID){
                child.name = ProductsRoot[j].ProductName;
                children.push(child);

            }
                      
        }
                //name
        obj.name = CategoriesRoot[i].CategoryName;
        obj.children = children;

        data.push(obj);
        
    }
   // return data;  
    var level1 = new Object();
    level1.name = "Product List";
    level1.children = data;
    var root = [];
    root.push(level1);
    return root;

}

    function readProducts() {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                // Read data from xml and store to js vector
                readProductsdata(this);
 
            }
        };

        xhttp.open("GET", "../xml/products.xml", true);
        xhttp.send();
    }

    function readProductsdata(xml) {
        var xmlDoc = xml.responseXML;
        var x = xmlDoc.getElementsByTagName("Products");

        for (let index = 0; index < x.length; index++) {
            //Store all categories' elements
            var ProductID = x[index].getElementsByTagName("ProductID")[0].childNodes[0].nodeValue;
            var ProductName = x[index].getElementsByTagName("ProductName")[0].childNodes[0].nodeValue;
            var CategoryID = x[index].getElementsByTagName("CategoryID")[0].childNodes[0].nodeValue;
            var QuantityPerUnit = x[index].getElementsByTagName("QuantityPerUnit")[0].childNodes[0].nodeValue;
            var UnitPrice = x[index].getElementsByTagName("UnitPrice")[0].childNodes[0].nodeValue;

            var Products = new Object();
            Products.ProductID = ProductID;
            Products.ProductName = ProductName;
            Products.CategoryID = CategoryID;
            Products.QuantityPerUnit = QuantityPerUnit;
            Products.UnitPrice = UnitPrice;

            ProductsRoot.push(Products);
        }

    }


function readCategories(xml) {

  var xmlDoc = xml.responseXML;
  var x = xmlDoc.getElementsByTagName("Categories");

  // To store categores
  for (let index = 0; index < x.length; index++) {

    //Store all categories' elements
      var CategoryID = x[index].getElementsByTagName("CategoryID")[0].childNodes[0].nodeValue;
      var CategoryName = x[index].getElementsByTagName("CategoryName")[0].childNodes[0].nodeValue;
      var Description = x[index].getElementsByTagName("Description")[0].childNodes[0].nodeValue;
      var Categories = new Object();
      Categories.CategoryID = CategoryID;
      Categories.CategoryName = CategoryName;
      Categories.Description = Description;

      CategoriesRoot.push(Categories);
  }


}

    $('#tree1').on(
        'tree.select',
        function (event) {
            if (event.node) {
                // node was selected
                var node = event.node;
                alert(node.name + node.getLevel());

                if (node.getLevel() == 1) {
                    //This is parents node, display descriptions from categories.xml
                    //clickParentNode(node.name);
                    //alert(node.name + "This is parent node");
                    //alert(node.name + node.getLevel());

                } else if(node.getLevel() == 2) {
                    //This is parents node, display price and QuantityPerUnit from products.xml
                    //clickChildNode(node.name);
                    //alert(node.name + "This is child node");
                } else{
                    //
                }
               
            }
            else {
                // event.node is null
                // a node was deselected
                // e.previous_node contains the deselected node
            }
        }
    );


    function clickParentNode(nodeName) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                // Read data from xml and store to js vector
                getDescription(this, nodeName);


            }
        };
        xhttp.open("GET", "../xml/categories.xml", true);
        xhttp.send();
    }

    function getDescription(xml, ParentNodeName) {
        var xmlDoc = xml.responseXML;
        var x = xmlDoc.getElementsByTagName("Categories");
        // To store categores
        for (let index = 0; index < x.length; index++) {
            //description of categories
            var str = x[index].getElementsByTagName("CategoryName")[0].childNodes[0].nodeValue;
            if (str == ParentNodeName) {
                var currentnode = x[index].getElementsByTagName("Description")[0].childNodes[0];
                var des = "Description: " + currentnode.nodeValue;

                alert(des);
            }
        }

    }



</script>
</body>
</html>